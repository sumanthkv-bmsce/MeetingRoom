<!DOCTYPE html>
<html>
<head>
	<title>Welcome</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
	</script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="./css/main.css">

	<script type="text/javascript">

		function populate() {
			$.ajax({
				type: 'GET',
				url: '/getCurrentUserRequests',
				dataType: "json",
				success: function(response){
					//alert("a");
						var results = response.Success;
						$("#tabcontent").empty();

						for(var id in results) {
							var temp = `<div>Location: ${results[id].locationName}</div> <div> ${results[id].Date} 
							</div> <div>${results[id].StartTime} </div> <div>${results[id].EndTime} </div> <div>${results[id].NumberOfPeople} </div>
							<div>${results[id].Status} </div><br>`
							
							if(results[id].Status === 'Pending') {
								$("#tabcontent").append(temp)
							}
						}

						for(var id in results) {
							var temp = `<div>Location: ${results[id].locationName}</div> <div> ${results[id].Date} 
							</div> <div>${results[id].StartTime} </div> <div>${results[id].EndTime} </div> <div>${results[id].NumberOfPeople} </div>
							<div>${results[id].Status} </div><br>`
							
							if(results[id].Status === 'Approved') {
								$("#tabcontent").append(temp)
							}
						}
						
					},
					error: function() {}
				})
		}

		function onCall() {
			$.ajax({
				type: 'GET',
				url: '/allLocationData',
				dataType: "json",
				success: function(response){
					//alert("a");
						$("#actualData").empty()
						for(var resp in response) {
							var temp = `<br><div><div>Location : ${response[resp].locationName} <br></div>
							<div>Total Number Of Rooms : ${response[resp].NumberOfRooms} <br></div>
							<div>Available Rooms : ${response[resp].RemainingRooms} <br></div></div><br><br>`
							$('#actualData').append(temp);
						}

						
					},
					error: function() {}
				})
		}

		function checkFun() {

			var location = document.getElementById("filter").value;
			if(location == "All") {
				return onCall()
			}

			$.ajax({
				type: 'POST',
				url: '/filteredData',
				data: {
					"location": location
				},
				dataType: "json",
				success: function(response){
					//alert("a");
					$("#actualData").empty()
						console.log(response);

						for(var resp in response) {
							var temp = `<br><div><div>Location : ${response[resp].locationName} <br></div>
							<div>Total Number Of Rooms : ${response[resp].NumberOfRooms} <br></div>
							<div>Available Rooms : ${response[resp].RemainingRooms} <br></div></div><br><br>`
							$('#actualData').append(temp);
						}

						
					},
					error: function() {}
				})

		}

		$(document).ready(function(){

			onCall();

			$("#btn_all_request").click(()=> {
				if(document.getElementById("tabcontent").style.display !=='none') {
					document.getElementById("tabcontent").style.display = 'none'
				}
				else {
					populate();
					document.getElementById("tabcontent").style.display = 'block'
				}
				

			});

		});

	</script>


</head>

<body>
	<div class="col-md-4 col-md-offset-4">
		<div id = "LocationData">
			<div id = "actualData">

			</div>
		</div>
		<div>
			
				<table class="table table-hover text-center">
					<a href = "\postRequest">New Meeting Request</a>
				</table>
			
		</div>
		<div>
			<label for="location">Select location: </label>
			<select name="filter" id="filter" onchange="checkFun()" required>
				<option value="All" selected>All</option>
				<option value="Bangalore">Bangalore</option>
				<option value="Delhi">Delhi</option>
				<option value="Mumbai">Mumbai</option>
			</select>
		</div>

		<button id = "btn_all_request" value = "hide/show">Show all requests</button>
		<div id="tabcontent">
		</div>

		<footer>
			<div class="abc">
				<a href="/logout">Logout</a>
			</div>
		</footer>

	</div>
</body>
</html>